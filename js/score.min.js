function e(){$(".hidable").toggle(1e3)}var t="";for(let e=3e3;e<3200;e++)t+=e.toString()+",";function K(e,t){return(e=Math.round(e*10**t)/10**t).toFixed(t)}var t=t.slice(0,t.length-1),a=0,X=0,s={},Z={},ee={},d,te;function prevFile(){X=(X-1+a)%a,y()}function nextFile(){X=(X+1)%a,y()}function ae(){$(".chart").hide(300),$("#fileOutput").html(""),$("#name").html("")}function r(e){s[a]=e.target.files[0],X=a,a++,$("#controls").removeClass("disabled"),$("#lbtn").removeClass("disabled"),$("#rbtn").removeClass("disabled"),y(1)}document.onkeydown=function(e){var t=e||window.event||arguments.callee.caller.arguments[0];t&&("ArrowLeft"==t.key?prevFile():"ArrowRight"==t.key&&nextFile())};const o=CryptoJS.enc.Utf8.parse("abcdefgabcdefg12");function se(e){e=CryptoJS.lib.CipherParams.create({ciphertext:CryptoJS.enc.Hex.parse(e)});return CryptoJS.AES.decrypt(e,o,{mode:CryptoJS.mode.ECB,padding:CryptoJS.pad.Pkcs7}).toString(CryptoJS.enc.Utf8)}function n(e){return CryptoJS.AES.encrypt(e,o,{mode:CryptoJS.mode.ECB,padding:CryptoJS.pad.Pkcs7}).ciphertext.toString()}function l(t){var a,s=new Array,r=t.length;for(let e=0;e<r;e++)65536<=(a=t.charCodeAt(e))&&a<=1114111?(s.push(a>>18&7|240),s.push(a>>12&63|128),s.push(a>>6&63|128),s.push(63&a|128)):2048<=a&&a<=65535?(s.push(a>>12&15|224),s.push(a>>6&63|128),s.push(63&a|128)):128<=a&&a<=2047?(s.push(a>>6&31|192),s.push(63&a|128)):s.push(255&a);return s}function i(e){e='{"meId":'+$("#Id").val()+',"seIds":"'+t+'","schoolId":19707,"studentId":"'+e+'"}';console.log(e),e=n(e),console.log(e),fetch("http://36.112.23.77/analysis/api/student/exam/getStudentReportMEVO",{method:"POST",headers:{"Content-type":"application/json"},body:e}).then(e=>{e.text().then(e=>{s[a]=new Blob([e],{type:"text/plain"}),X=a,a++,$("#controls").removeClass("disabled"),$("#lbtn").removeClass("disabled"),$("#rbtn").removeClass("disabled"),y(1)})})}function fetchMe(t){parseInt(t)?i(t):fetch("/js/e.json",{method:"GET",headers:{"Content-type":"application/json"}}).then(e=>{e.json().then(e=>{i(e.data.filter(function(e){return e.name==t})[0].no)})})}function imageLoaded(t){var e=$("img")[t],a=e.width/e.naturalWidth;$(".cover"+t).empty();for(var s=0;s<d.displayIndexDetails.length;s++){var r=d.displayIndexDetails[s],o=r.eqAnswerIpxywh.split("#");for(let e=0;e<o.length;e++){var n,l=o[e].split(",");6==l.length?parseInt(l[1])-1==t&&(n=$('<span class="minus" style="transform:translate('+(l[2]*a).toFixed(6)+"px,"+(l[3]*a).toFixed(6)+'px)">'+(r.eqScore==r.eqFullScore?r.eqFullScore.toString():0==r.eqScore?(r.eqScore-r.eqFullScore).toString():r.eqScore.toString()+"/"+r.eqFullScore.toString())+"</span>").appendTo(".cover"+t),r.eqScore==r.eqFullScore?n.addClass("full"):h(n)):0==t&&(n=$('<span class="sp" style="transform:translate('+(l[1]*a).toFixed(6)+"px,"+(l[2]*a).toFixed(6)+"px);width:"+(l[3]*a).toFixed(6)+"px;height:"+(l[4]*a).toFixed(6)+'px"></span>').appendTo(".cover"+t),0==e&&r.eqFullScore!=r.eqScore&&h($('<span class="minus" style="transform:translate('+(l[1]*a-20).toFixed(6)+"px,"+(l[2]*a-5).toFixed(6)+'px)">'+(r.eqScore-r.eqFullScore).toString()+"</span>").appendTo(".cover"+t)),r.eqCorrectAnswer.match("ABCD"[e])?n.addClass("cor"):r.eqAnswer.match("ABCD"[e])&&n.addClass("err"))}}}function getSe(e){te=e,u=14,Z[X]||(Z[X]=prompt("数字校园号？")),ee[X]||(ee[X]=prompt("考试编号？（心意答点击考试标题后，切换考试的列表里可见）"));var t=n('{"schoolId":19707,"seId":'+e+',"studentId":"'+Z[X]+'"}');fetch("http://36.112.23.77/analysis/api/student/exam/getStudentReportSEVO",{method:"POST",headers:{"Content-type":"application/json"},body:t}).then(e=>{e.json().then(e=>{})}),t='{"schoolId":19707,"meId":'+ee[X]+',"seId":'+e+',"studentId":"'+Z[X]+'"}',console.log(t),t=n(t),fetch("http://36.112.23.77/analysis/api/student/exam/getStuExamDetailInfo",{method:"POST",headers:{"Content-type":"application/json"},body:t}).then(e=>{e.json().then(e=>{$("#singleDat").empty();var t=JSON.parse(se(e.data));for(let e=1;e<=t.pageCount;e++)$("#singleDat").append('<br><span class="cover'+(e-1)+'"></span><img src="http://36.112.23.77'+t.examUrl+"page_"+e+'.jpg" onload="imageLoaded('+(e-1)+')">'),$("img")[e-1].style.width="100%";d=t})})}var c=[],m,u;function p(){for(let e=0;e<c.length;e++)clearInterval(c[e]);c=[]}function h(e){var t,a=0;c.push(setInterval(function(){t=100*Math.random()-50,$(e).css("transform",$(e).css("transform").split("rotate")[0]+"rotate("+(t-a)+"deg)"),a=t},600*Math.random()+300))}function re(e){return 90<=e?"success":75<=e?"info":60<=e?"warning":"danger"}function resizeChart(){clearTimeout(m),m=setTimeout(function(){p(),sChart1.resize(),sChart2.resize(),oChart1.resize(),oChart2.resize(),oChart3.resize(),oChart4.resize(),"0px"==$("#score1>div").css("width")?$("#resizeBtn").show():$("#resizeBtn").hide(300);for(let e=0;e<d.pageCount;e++)imageLoaded(e);$(".minus").css("font-size",u)},300)}function oe(){return 972==ee[X]||957==ee[X]||951==ee[X]?"15":970==ee[X]?"13":"?"}var S=document.createElement("a"),f,g;function x(){S.href=f,S.setAttribute("download","data.txt"),S.click()}function y(U=0){console.log("Start processing No. "+X);var e=s[X],V=(f=window.URL.createObjectURL(e),$("#message")[0]),_='<table class="table table-responsive" style="table-layout: fixed;"><tr><td>平均分</td><td>最高分</td><td>75%</td><td>中位数</td><td>25%</td><td>最低分</td></tr>',t=(V.innerHTML=X+1+"/"+a+" - "+e.name+" - "+e.size+" 字节 - "+e.type+" - 正在读取...<br>>",$("#upbtn").removeClass("btn-danger"),$("#upbtn").addClass("btn-info"),$("#upicon").removeClass("glyphicon-exclamation-sign"),$("#upicon").addClass("glyphicon-open"),new FileReader);t.onload=function(D){try{var k=$("#fileOutput")[0],e=$("#fileInfo")[0],L=$("#name")[0],t=eval("("+D.target.result+")"),a="",s="",r=($("#single").empty(),t.data=eval("("+se(t.data).toString()+")"),ee[X]=t.data.meId.toString(),Z[X]=t.data.studentId,e.innerHTML="<h3>"+t.data.multiExam.meName+"</h3>",[]),o=[],H=1,n=t.data.multiExamStudentScore.singleExamStudentScores,l=t.data.singleExamClassScores,d=t.data.singleExamClassYsScores,i=t.data.multiExam.singleExams,r=t.data.seIds,c=r.length;for(let t=0;t<c;t++)for(let e=0;e<c;e++)i[t].seId==r[e]&&(o[e]=i[t].seCourseName);var m={};for(let e=0;e<c;e++)m[r[e]]=o[e];m[0]="总分";for(let e=0;e<d.length;e++)m[d[e].seId+"Ys"]=m[d[e].seId]+" "+d[e].ysClassId;var u={},W={},j={};for(let t=0;t<c;t++)for(let e=0;e<c;e++)n[e]&&n[e].seId==r[t]&&(j[t]=!0,u[e]=t);for(let e=1;e<c;e++)j[e]||(r[e]=-1);for(let e=0;e<c;e++)W[u[e]]=e;var p={},h={},S={},f={},g={},x={},y={},C={},b={},v={},O={},P={},J={},I={},E;for(let e=0;e<c;e++){n[e]&&(E=n[e].seId,p[E]=n[e].essScore,h[E]=l[e].secsAvgScore,S[E]=l[e].secsMinScore,f[E]=l[e].secsQuarterScore,g[E]=l[e].secsHalfScore,x[E]=l[e].secs3quatrerScore,y[E]=l[e].secsMaxScore,C[E]=i[u[e]].seFullScore,b[E]=n[e].essClassOrder,O[E]=n[e].essGradeOrder,P[E]=K(1-n[e].essClassOrder/l[e].secsStudentCount,3),I[E]=K(1-n[e].essGradeOrder/i[u[e]].seStudentCount,3))}P[0]=K(1-t.data.multiExamStudentScore.messClassOrder/t.data.multiExamClassScores[0].mecsStudentCount,3),I[0]=K(1-t.data.multiExamStudentScore.messGradeOrder/t.data.multiExamSchoolScore.mecsStudentCount,3),b[0]=t.data.multiExamStudentScore.messClassOrder,O[0]=t.data.multiExamStudentScore.messGradeOrder;for(let t=0;t<d.length;t++)for(let e=0;e<c;e++)n[e]&&d[t].seId==n[e].seId&&(J[d[t].seId+"Ys"]=K(1-n[e].essYsClassOrder/d[t].secsStudentCount,3),v[d[t].seId+"Ys"]=n[e].essYsClassOrder);var B=oe();for(let e=0;e<c;e++){var w=W[e];if(n[w]){$("#single").append('<button class="btn btn-'+re(K(100*I[r[e]],1))+' btn-how" onclick="getSe('+r[e]+");$('.btn-how').removeClass('active');$(this).addClass('active')\">"+m[n[w].seId]+"</button>"),a+="<h3 class='bg-"+re(K(100*I[r[e]],1))+" text-"+re(K(100*I[r[e]],1))+"'>"+m[n[w].seId]+" <small>"+n[w].essScore+"</small></h3><h4>"+t.data.examStudents[0].classId+" 班内：</h4>"+n[w].essClassOrder+" / "+l[w].secsStudentCount+_+"<tr><td>"+l[w].secsAvgScore+"</td><td>"+l[w].secsMaxScore+"</td><td>"+l[w].secs3quatrerScore+"</td><td>"+l[w].secsHalfScore+"</td><td>"+l[w].secsQuarterScore+"</td><td>"+l[w].secsMinScore+"</td></tr></table>",s="，"+t.data.examStudents[0].classId+" 班 "+l[w].secsClassOrder+" / "+B;for(let e=0;e<d.length;e++)d[e].seId==n[w].seId&&(a+="<h4>"+d[e].ysClassId+" 层内：</h4>"+n[w].essYsClassOrder+" / "+d[e].secsStudentCount+_+"<tr><td>"+d[e].secsAvgScore+"</td><td>"+d[e].secsMaxScore+"</td><td>"+d[e].secs3quatrerScore+"</td><td>"+d[e].secsHalfScore+"</td><td>"+d[e].secsQuarterScore+"</td><td>"+d[e].secsMinScore+"</td></tr></table>",s+="，"+d[e].ysClassId+" 层 "+d[e].secsClassOrder+" / ?");a+="<h4>年级：</h4>"+n[w].essGradeOrder+" / "+i[u[w]].seStudentCount+s+_+"<tr><td>"+i[u[w]].seAvgScore+"</td><td>"+i[u[w]].seMaxScore+"</td><td>"+i[u[w]].se3QuarterScore+"</td><td>"+i[u[w]].seHalfScore+"</td><td>"+i[u[w]].seQuarterScore+"</td><td>"+i[u[w]].seMinScore+"</td></tr></table>"}}te=te||r[0],getSe(te)}catch(e){return console.log(e),ae(),V.innerHTML+="读取失败！",$("#upbtn").removeClass("btn-info"),$("#upbtn").addClass("btn-danger"),$("#upicon").removeClass("glyphicon-open"),void $("#upicon").addClass("glyphicon-exclamation-sign")}var G,Y=($("#single").append("<button class=\"btn btn-default btn-how\" onclick=\"fontSize+=3;$('.minus').css('font-size',fontSize+'px');for (let i = 0; i < datSe.pageCount; i++)$('img')[i].style.width=parseInt($('img')[i].style.width)+20+'%';resizeChart()\"><span class=\"glyphicon glyphicon-zoom-in\"></span></button>"),$("#single").append("<button class=\"btn btn-default btn-how\" onclick=\"fontSize-=3;$('.minus').css('font-size',fontSize+'px');for (let i = 0; i < datSe.pageCount; i++)$('img')[i].style.width=parseInt($('img')[i].style.width)-20+'%';resizeChart()\"><span class=\"glyphicon glyphicon-zoom-out\"></span></button>"),$("#single").append('<span id="singleDat" style="word-wrap: break-word; white-space: normal"></span><br><br><br>'),U&&(G=JSON.stringify({content:t.data.multiExamStudentScore.studentName+" "+parseInt(t.data.examStudents[0].classId)}),fetch("/score/log",{method:"POST",headers:{"Content-type":"application/json"},body:G})),V.innerHTML+="读取成功！ - 注：实验中学 74 桌出品，我仅做搬运修改。<br>",L.innerHTML="姓名："+t.data.multiExamStudentScore.studentName,e.innerHTML="<h3>"+t.data.multiExam.meName+" <small>"+t.data.examStudents[0].classId+"班 "+t.data.multiExamStudentScore.studentName+"</small></h3>",k.innerHTML=1<c?"<h3>总分 <small>"+t.data.multiExamStudentScore.messScore+"</small></h3><h4>"+t.data.examStudents[0].classId+" 班内：</h4>"+t.data.multiExamStudentScore.messClassOrder+" / "+t.data.multiExamClassScores[0].mecsStudentCount+_+"<tr><td>"+t.data.multiExamClassScores[0].mecsAvgScore+"</td><td>"+t.data.multiExamClassScores[0].mecsMaxScore+"</td><td>"+t.data.multiExamClassScores[0].mecs3quatrerScore+"</td><td>"+t.data.multiExamClassScores[0].mecsHalfScore+"</td><td>"+t.data.multiExamClassScores[0].mecsQuarterScore+"</td><td>"+t.data.multiExamClassScores[0].mecsMinScore+"</td></tr></table><h4>年级：</h4>"+t.data.multiExamStudentScore.messGradeOrder+" / "+t.data.multiExamSchoolScore.mecsStudentCount+"，"+t.data.examStudents[0].classId+"班 "+t.data.multiExamClassScores[0].mecsClassOrder+" / "+B+_+"<tr><td>"+t.data.multiExam.meAvgScore+"</td><td>"+t.data.multiExam.meMaxScore+"</td><td>"+t.data.multiExam.me3QuatrerScore+"</td><td>"+t.data.multiExam.meHalfScore+"</td><td>"+t.data.multiExam.meQuarterScore+"</td><td>"+t.data.multiExam.meMinScore+"</td></tr></table>"+a:a,$("#fileOutput table").css("display","inline-table"),$("#fileOutput table").css("margin-bottom","0px"),$(".chart").show(),sChart1=echarts.init($("#score1")[0]),sChart2=echarts.init($("#score2")[0]),oChart1=echarts.init($("#order1")[0]),oChart2=echarts.init($("#order2")[0]),oChart3=echarts.init($("#order3")[0]),oChart4=echarts.init($("#order4")[0]),seNameDicP=[],scorePP=[],avgPP=[],rateFullP=[],scoreQ=[],avgQ=[],seNameDicP2=[],classOrderPP=[],gradeOrderPP=[],classOrderQ=[],gradeOrderQ=[],seNameDicP3=[],ysClassOrderPP=[],ysClassOrderQ=[],r[c]=0,[]),R=[],A;for(let e=0;e<c;e++){var w=r[e];-1!=w&&"总分"!=m[w].substr(0,2)&&(seNameDicP.push(m[w].substr(0,2)),scorePP.push(p[w]),avgPP.push(h[w]),rateFullP.push(C[w]),Y.push({value:[S[w],f[w],g[w],x[w],y[w]]}),scoreQ.push(K(p[w]/C[w]*100,1)),avgQ.push(K(h[w]/C[w]*100,1)),R.push({value:[K(S[w]/C[w]*100,1),K(f[w]/C[w]*100,1),K(g[w]/C[w]*100,1),K(x[w]/C[w]*100,1),K(y[w]/C[w]*100,1)]}))}console.log(r);for(let e=0;e<=c;e++){var w=r[e];-1==w||"总分"==m[w].substr(0,2)&&1==c||(seNameDicP2.push(m[w].substr(0,2)),classOrderPP.push(b[w]),gradeOrderPP.push(O[w]),classOrderQ.push(K(100*P[w],1)),gradeOrderQ.push(K(100*I[w],1)))}for(A in v)seNameDicP3.push(m[A]),ysClassOrderPP.push(v[A]),ysClassOrderQ.push(K(100*J[A],1));var z={textStyle:{fontFamily:"Noto Serif SC"},tooltip:{trigger:"axis"},toolbox:{show:!0,feature:{saveAsImage:{show:!0},dataView:{show:!0,readOnly:!1}},orient:"vertical"},emphasis:{focus:"series"},calculable:!0},T={...z},M={...z},Q={...z},F={...z},N={...z},q={...z};T.title={text:"分数",textStyle:{fontSize:14,fontStyle:"normal",fontWeight:"bold"}},T.legend={data:["四分位","满分","平均分","我的分数"]},T.xAxis=[{axisTick:{alignWithLabel:!0},type:"category",data:seNameDicP,name:"科目",position:"left"}],T.yAxis=[{type:"value",name:"分数",position:"left"}],T.series=[{name:"四分位",type:"boxplot",data:Y,color:"#5bc0de",itemStyle:{color:"transparent"}},{name:"满分",type:"scatter",data:rateFullP,color:"#b6b6b6"},{name:"平均分",type:"line",data:avgPP,color:"#337ab7"},{name:"我的分数",type:"line",data:scorePP,color:"#e2041b"}],M.title={text:"得分率",textStyle:{fontSize:14,fontStyle:"normal",fontWeight:"bold"}},M.legend={data:["四分位","平均得分率","我的得分率"]},M.xAxis=[{axisTick:{alignWithLabel:!0},type:"category",data:seNameDicP,name:"科目",position:"left"}],M.yAxis=[{type:"value",name:"得分率(%)",position:"left"}],M.series=[{name:"四分位",type:"boxplot",data:R,color:"#5bc0de",itemStyle:{color:"transparent"}},{name:"平均得分率",type:"line",data:avgQ,color:"#337ab7"},{name:"我的得分率",type:"line",data:scoreQ,color:"#d9534f"}],Q.title={text:"行政排名位次",textStyle:{fontSize:14,fontStyle:"normal",fontWeight:"bold"}},Q.legend={data:["班级排名","年级排名"]},Q.xAxis=[{axisTick:{alignWithLabel:!0},type:"category",data:seNameDicP2,name:"科目",position:"left"}],Q.yAxis=[{type:"value",name:"排名",position:"left"}],Q.series=[{name:"班级排名",type:"bar",data:classOrderPP,color:"#5bc0de"},{name:"年级排名",type:"bar",data:gradeOrderPP,color:"#337ab7"}],F.title={text:"行政排名比例",textStyle:{fontSize:14,fontStyle:"normal",fontWeight:"bold"}},F.legend={data:["班级排名(%)","年级排名(%)"]},F.xAxis=[{axisTick:{alignWithLabel:!0},type:"category",data:seNameDicP2,name:"科目",position:"left"}],F.yAxis=[{type:"value",name:"排名(%)",position:"left",max:100}],F.series=[{name:"班级排名(%)",type:"bar",data:classOrderQ,color:"#5bc0de"},{name:"年级排名(%)",type:"bar",data:gradeOrderQ,color:"#337ab7"}],N.title={text:"分班排名位次",textStyle:{fontSize:14,fontStyle:"normal",fontWeight:"bold"}},N.legend={data:["分班排名"]},N.xAxis=[{axisTick:{alignWithLabel:!0},type:"category",data:seNameDicP3,name:"科目",position:"left"}],N.yAxis=[{type:"value",name:"排名",position:"left"}],N.series=[{name:"分班排名",type:"bar",data:ysClassOrderPP,color:"#5cb85c"}],q.title={text:"分班排名比例",textStyle:{fontSize:14,fontStyle:"normal",fontWeight:"bold"}},q.legend={data:["分班排名(%)"]},q.xAxis=[{axisTick:{alignWithLabel:!0},type:"category",data:seNameDicP3,name:"科目",position:"left"}],q.yAxis=[{type:"value",name:"排名(%)",position:"left",max:100}],q.series=[{name:"分班排名(%)",type:"bar",data:ysClassOrderQ,color:"#5cb85c"}],sChart1.setOption(T),sChart2.setOption(M),oChart1.setOption(Q),oChart2.setOption(F),oChart3.setOption(N),oChart4.setOption(q),window.onresize=resizeChart},t.readAsText(e)}$().ready(function(){$(".chart").hide(),$(function(){$("[data-toggle='tooltip']").tooltip()}),$("#Input").keydown(function(e){13==e.keyCode&&$("#fetchBtn")[0].click()})});